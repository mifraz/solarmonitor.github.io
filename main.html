<!DOCTYPE html>
<html class="fixed">
	<script type="text/javascript">
		function GetRequest() {
			var url = location.search; //获取url中"?"符后的字串   
			var theRequest = new Object();
			if(url.indexOf("?") != -1) {
				var str = url.substr(1);
				var strs = str.split("&");
				for(var i = 0; i < strs.length; i++) {
					theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
				}
			}
			return theRequest;
		}
		var globalStorage = JSON.parse(window.localStorage.getItem("globalStorage"));

		var userInfo = globalStorage.accounts[globalStorage.accounts.length - 1].dat

		if(userInfo.role == 1 || userInfo.role == 2)
			window.location.href = "/managesystemnew/index.html?" + (new Date().getTime());
		else if(userInfo.role == 15) {
			//				alert("userInfo")
			window.location.href = "/admin/main.html?" + (new Date().getTime());
		}

		MAPID = "zh-CN";
		VERSION = "V1.10.1.1"; //版本控制
		
		// google地图已经修改为maptalks地图无需加载以下内容，暂时隐藏
		// var id = globalStorage.accounts[((GetRequest().index == undefined || GetRequest().index == "undefined") ? 0 : GetRequest().index)].lang;
		// if(id == 0) {
		// 	//			
		// 	//			MAPID = "zh-CN";
		// 	//			document.write("<script type='text/javascript' src='http://maps.google.cn/maps/api/js?&language="+MAPID+"&sensor=true&key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script>")
		// } else if(id == 1) {
		// 	MAPID = "en-US";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// 	// document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.google.cn/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");

		// } else if(id == 2) {
		// 	MAPID = "en-US";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");

		// } else if(id == 3) {

		// 	MAPID = "pt-BR";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 4) {

		// 	MAPID = "es-ES";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 5) {
		// 	MAPID = "pl-PL";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 6) {
		// 	MAPID = "zh-HK";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 7) {
		// 	MAPID = "in_IN";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 8) {
		// 	MAPID = "vi_VN";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
		// else if(id == 9) {
		// 	MAPID = "in_ID";
		// 	document.write("<script type='text/javascript' src='https://www.shinemonitor.com/&quot;&#32;+&#32;document.location.protocol&#32;+&#32;&quot;//maps.googleapis.com/maps/api/js?&amp;language=&quot;&#32;+&#32;MAPID&#32;+&#32;&quot;&amp;sensor=true&amp;key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");
		// }
	</script>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="pragma" content="no-cache">
		<!-- 	boostrap兼容IE9 -->
		<meta http-equiv="X-UA-Compatible" content="ie=edge;chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link href="main.html" rel="shortcut icon" class="cusIcoFirst">
		<link rel="stylesheet" href="./assets/vendor/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" href="./assets/vendor/font-awesome/css/font-awesome.css" />
		<link rel="stylesheet" href="./assets/vendor/bootstrap-datepicker/css/bootstrap-datepicker3.css" />
		<link rel="stylesheet" href="./assets/vendor/jquery-ui/jquery-ui.css" />
		<link rel="stylesheet" href="./assets/vendor/jquery-ui/jquery-ui.theme.css" />
		<link rel="stylesheet" href="./assets/vendor/bootstrap-multiselect/bootstrap-multiselect.css" />
		<link rel="stylesheet" href="./assets/vendor/jstree/themes/default/style.css" />

		<link rel="stylesheet" href="./assets/stylesheets/theme.css" />
		<link rel="stylesheet" href="./assets/stylesheets/theme-custom.css">
		<link rel="stylesheet" type="text/css" href="css/reg.css">

		<link rel="stylesheet" href="./assets/stylesheets/validationEngine.jquery.css" />
		<link rel="stylesheet" type="text/css" href="./assets/vendor/showLoading/css/showLoading.css" />
		<link rel="stylesheet" href="./assets/vendor/jquery-datatables/jquery.dataTables.min.css" />
		<link rel="stylesheet" type="text/css" href="./css/common.css">
		<link rel="stylesheet" type="text/css" href="./css/weather.css" />
		<link rel="stylesheet" type="text/css" href="./pvcurve/css/pvcurve.css" />
		<!--<link rel="stylesheet" href="//cache.amap.com/lbs/static/main.css?v=1.0" />-->
		<link rel="stylesheet" type="text/css" href="./assets/vendor/liMarquee/css/liMarquee.css" />
		<!-- <link rel="stylesheet" type="text/css" href="/assets/vendor/style-switcher/.css" /> -->
		<!--这个是日历选择的js必须放到最前面 -->
		<script src="./assets/vendor/modernizr/modernizr.js"></script>

		<script type="text/javascript">
		console.log("woshikaishi")
		    var hostname = window.document.location.hostname
			if(hostname =="www.renovigi.solar"){
				console.log("www.renovigi.solar")
			  document.write("<link href="https://www.shinemonitor.com/\&quot;/dingzhi/renovigi/reg.css\&quot;" rel=\"stylesheet\" type=\"text/css\">" )
			  document.write("<link href="https://www.shinemonitor.com/\&quot;/dingzhi/renovigi/theme.css\&quot;" rel=\"stylesheet\" type=\"text/css\">" )
			}
			else {
				console.log("woshiElse")
				document.write("<link href="https://www.shinemonitor.com/\&quot;/css/reg.css\&quot;" rel=\"stylesheet\" type=\"text/css\">" )
				document.write("<link href="https://www.shinemonitor.com/\&quot;/assets/stylesheets/theme.css\&quot;" rel=\"stylesheet\" type=\"text/css\">" )
			}
			console.log("woshijiewei")
		</script>

		<style type="text/css">
			.tableStyle thead tr:first-child {
				background-color: #e7f3e9;
			}
			
			.tableStyle thead tr th {
				text-align: center;
			}
			
			.tableStyle tr:nth-child(odd) {
				background-color: white;
			}
			
			.hengtongyuan {
				display: none;
				margin: 20px;
				font-size: 20px;
				color: red;
			}
		</style>
	</head>

	<body>
		<section class="body">
			<!-- header -->
			<header class="header">
				<!-- ===============================================================================切换电站====================================== -->

				<div class="logo-container">
					<a href="main.html#" class="logo" onclick="checkUserPlantlist()">
						<img src="main.html" id="cusMainImg" />
					</a>
					<div class="userbox plantlist">
						<a href="main.html#" data-toggle="dropdown">
							<i class="fa fa-cubes"></i>
							<div class="profile-info">
								<!-- 特别注意此处不能用lang标签切换语言,否则无法显示选中了哪个电站 -->
								<span class="name" id="checkedPlant"></span>
							</div>
							<i class="fa custom-caret"></i>
						</a>

						<div class="dropdown-menu" id="plantlist">
							<em class="curPlantId"></em>
							<ul class="list-unstyled" style="max-height: 600px;overflow-y:auto ;">

							</ul>
						</div>

					</div>
				</div>

				<div class="header-left">

					<button class="btn btn-primary1" type="button" id="msgBtn" style="display: none;">
						消息<span class="badge" id="MsgBoxCount">0</span>
					</button>
				</div>
				<marquee width="200" hight="40" behavior="scroll" direction="" class="hengtongyuan">
					全国热线电话：4008096133
				</marquee>
				<!-- ===============================================================================系统设置与语言切换====================================== -->
				<div class="header-right">
					<!-- <span class="separator"></span>
					<div class="userbox">
					  <select id="selectNode"  style="height: 40px; background: #189bf5;color: #000;border:#189bf5"></select>
					</div> -->
					<span class="separator"></span>
					<div id="userbox" class="userbox">
						<a href="main.html#" data-toggle="dropdown">
							<figure class="profile-picture">
								<img src="./assets/images/user_pic.jpg" alt="Xie" class="img-circle" data-lock-picture="/assets/images/%21logged-user.jpg" />
							</figure>
							<div class="profile-info">
								<span class="name" id="userInfo"></span>
								<span class="name"></span>
							</div>
							<i class="fa custom-caret"></i>
						</a>

						<div class="dropdown-menu  main-shine-menu">
							<ul class="list-unstyled">
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="go2System()">
										<i class="fa fa-user"></i>
										<span lang="system_settings">系统设置</span>

									</a>
								</li>

								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" id="accountLogout">
										<i class="fa fa-power-off"></i>
										<span lang="log_out">退出</span>
									</a>
								</li>
							</ul>
						</div>
					</div>

					<span class="separator"></span>
					<div class="userbox">
						<a href="main.html#" data-toggle="dropdown">
							<div class="profile-info">
								<span class="name" id="mainCurLang"></span>
							</div>
							<i class="fa custom-caret"></i>
						</a>

						<div class="dropdown-menu">
							<!--  特别注意a里面的内容一定不要有空格 -->
							<ul class="list-unstyled">
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">English</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">中文</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">中文繁体</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">Svenska</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">Español</a>
								</li>
								
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">Português</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">Polski</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">India</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">TiếngViệt</a>
								</li>
								<li>
									<a role="menuitem" tabindex="-1" href="main.html#" onclick="changLangMain(this.text)">Indonesian</a>
								</li>
							</ul>
						</div>
					</div>
				</div>

			</header>
			<!-- inner-wrapper -->
			<div class="inner-wrapper" id="mainArea">

			</div>
			<!-- footer -->
			<footer>
				<p class="text-center mt-md mb-md footer-main">
					<a href="https://beian.miit.gov.cn" class="cusIcp"></a>
					<span class="cusIcp1" style="padding-left: 12px;">
				</span>
				</p>
			</footer>
		</section>
		<!--消息盒子-->
		<div class="modal fade" id="msgBox">
			<div class="modal-dialog modal-lg" style="width: 1000px;">

				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		        		<span aria-hidden="true">&times;
		        		</span>
		        </button>
						<h4 class="modal-title" lang="">消息详情
	        	</h4>
					</div>
					<div class="modal-body" id="msgtable">
						<table class="table table-bordered mb-none tableStyle">
							<thead>
								<tr>
									<th>首次发生时间</th>
									<th>所属电站</th>
									<th>告警类型</th>
									<th>告警编码</th>
									<th>设备序列号</th>
									<th>数采器编号</th>
									<th>告警描述</th>
									<th>处理状态</th>
									<th>消失时间</th>
								</tr>
							</thead>
							<tbody id="msgbody">
							</tbody>
						</table>
						<div id="pageMsg" class="page1">

						</div>
					</div>

				</div>
			</div>
		</div>
		<!-- 流量预警模态框 -->
		<div class="modal fade" id="flowExpirationDetection">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" lang="expiration_Warning">流量卡到期预警
						</h4>
					</div>
					<div class="modal-body">
							<p lang="expiration_Warning_Title">尊敬的用户您好！</p>
							<p lang="expiration_Warning_Body" style="text-indent:2em;">&nbsp;&nbsp;&nbsp;&nbsp;发现您所使用设备的流量卡即将到期，如未及时充值，则会造成该流量卡被运营商注销且不能继续使用。为了不影响您的正常使用，请及时对预警状态的设备进行充值！</p>
					</div>
					<div class="row">
						<div id="pwdPrompt" class="addColDisplay hidden text-center" >
							<span class="add_col_fail"></span>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-info" id="nowRecharge">
							<span lang="now_recharge">立即充值</span>
						</button>
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
<!-- <script src="https://cdn.jsdelivr.net/npm/xgplayer@2.9.6/browser/index.js" type="text/javascript" charset="utf-8"></script> -->
<script src="./assets/vendor/xgplayer/browser/index.js" type="text/javascript" charset="utf-8"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/xgplayer-hls/dist/index.min.js" type="text/javascript" charset="utf-8"></script> -->
<script src="./assets/vendor/xgplayer/xgplayer-hls/index.min.js" type="text/javascript" charset="utf-8"></script>
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maptalks/dist/maptalks.css"> -->
<link rel="stylesheet" href="./assets/vendor/maptalks/css/maptalks.css">
<!-- maptalks地图 -->
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/maptalks/dist/maptalks.min.js"></script> -->
<script src="./assets/vendor/maptalks/js/maptalks.min.js" type="text/javascript" charset="utf-8"></script>
<!-- maptalks地图 -->
<script src="./assets/vendor/jquery/jquery-2.1.4.min.js" type="text/javascript" charset="utf-8"></script>
<script src="./assets/vendor/laydate/laydate.js" type="text/javascript" charset="utf-8"></script>
<!-- 第三方文件加载，有时在国内会加再不出来，现把它改为本地 -->
<link rel="stylesheet" href="./assets/vendor/select2/css/select2.css" />
<script type="text/javascript" src="./assets/vendor/select2/js/select2.js" ></script>
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/css/select2.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/js/select2.min.js" ></script> -->
<!--layui时间插件-->
<script src="./js/layer/layer.js" type="text/javascript" charset="utf-8"></script>
<!--类ui弹出层 -->
<script src="./assets/vendor/bootstrap/js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
<!-- bootstrap库第二版-->
<script src="./assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript" charset="utf-8"></script>
<!-- 带英文时间选择插件设备数据明细选择用，可替换layui的时间选择-->
<script src="./assets/vendor/jquery-ui/jquery-ui.js" type="text/javascript" charset="utf-8"></script>
<!--jquery ui 框架 -->
<script src="./assets/vendor/jstree/jstree.js" type="text/javascript" charset="utf-8"></script>
<!-- 设备树插件，基于jquery -->
<script src="./assets/vendor/jquery-datatables/media/js/jquery.dataTables.js" type="text/javascript" charset="utf-8"></script>
<!--表格渲染插件 -->
<script src="./assets/vendor/jquery-datatables/extras/TableTools/js/dataTables.tableTools.min.js" type="text/javascript" charset="utf-8"></script>
<!--搭配表格渲染使用 -->
<script src="./js/jquery.ajaxQueue.min.js" type="text/javascript" charset="utf-8"></script>
<!--ajax队列化 -->
<script src="./js/echarts/dist/echarts.js" type="text/javascript" charset="utf-8"></script>
<!-- 图标插件 -->
<script src="./assets/vendor/showLoading/jquery.showLoading.min.js" type="text/javascript" charset="utf-8"></script>
<!-- 加载中 -->
<script src="https://cache.amap.com/lbs/static/es5.min.js" type="text/javascript" charset="utf-8"></script>
<!--高德地图 -->
<script src="https://webapi.amap.com/maps?v=1.3&amp;key=3066f0d8b9a5f187b8905b14d653585d" type="text/javascript" charset="utf-8"></script>
<!--高德地图 -->
<script src="./js/qrcode/jquery.qrcode.js" type="text/javascript" charset="utf-8"></script>
<!--二维码生成插件 -->
<script src="./js/qrcode/qrcode.js" type="text/javascript" charset="utf-8"></script>
<!--搭配二维码生成插件使用 -->
<script src="./assets/vendor/liMarquee/js/jquery.liMarquee.js" type="text/javascript" charset="utf-8"></script>
<!--//文字滚动插件-->
<script src="vendor_new/js/paging.min.js" type="text/javascript" charset="utf-8"></script>
<!--分页插件-->
<script src="./assets/javascripts/rc4.js" type="text/javascript" charset="utf-8"></script>
<script src="./assets/javascripts/sha1-min.js" type="text/javascript" charset="utf-8"></script>
<script type='text/javascript' src='js/jsaddr.js'></script>
<!--省市县三级联动-->
<script src="./js/map.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="" type="text/javascript" charset="utf-8" id="scripttest"></script>-->
<script type="text/javascript">
	//将需要进行版本控制的js放到数组中动态加载即可避免浏览器缓存问题
	var jsArr = [
		"/js/libhttp.js",
		"/js/misc.js",
		"/js/language.js",
		"/js/customer.js",
	]
	var jsStr = ""
	for(var i = 0; i < jsArr.length; i++) {
		jsStr += "<script type='text/javascript' src='https://mifraz.github.io/solarmonitor.github.io" + jsArr[i] + "?" + VERSION + "'><\/script>"
	}
	console.log(jsStr);
	//document.write()缺陷，文档流关闭后，再加载脚本会使页面空白，动态加载的js也会阻止页面渲染，因为不建议在此放过多js
	document.open()
	document.write(jsStr);
	document.close()
</script>
<script src="./assets/javascripts/jquery.validationEngine.js" type="text/javascript" charset="utf-8"></script>
<script src="./assets/javascripts/jquery.validationEngine-general.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
 
	//		document.write(scripeStr)
	//			document.write("<script type='text/javascript' src='http://maps.google.cn/maps/api/js?&language=" + MAPID + "&sensor=true&key=AIzaSyDRbbVGCfXIkdZV0kl0iQoxOicsacoj1sw'><\/script><script type='text/javascript' src='js/markerwithlabel.js'><\/script>");/**
	/** * 
	 * 
	 * 之前引入js的版本在svn2018.6.26之前有
	 * 
	 * */
	function dynamicLoadJs(url, callback) {
		var head = document.getElementById('scriptJs');
		var script = document.createElement('script');
		script.type = 'text/javascript';
		script.src = url;
		if(typeof(callback) == 'function') {
			script.onload = script.onreadystatechange = function() {
				if(!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
					callback();
					script.onload = script.onreadystatechange = null;
				}
			};
		}
		head.appendChild(script);
	}
</script>

<script type="text/javascript">
	//			防止多次点击退出报异常
	var accountLogoutid = true;
	javascript: window.history.forward(1);
	MAIN_CHOOSE_PLANT_ID = null;
	MAIN_CHOOSE_PLANT_TIMEZONE = null;
	intervalId = null; /*设备管理页面-刷新树间隔id*/
	$(document).ready(function() {
		 checkCusInfo();
		 checkUserCurLang();
		// $.get(document.location.protocol + "//img.shinemonitor.com/file/",
		// 		{
		// 			action: 'queryAllCustInfosByDomainName',
		// 			domainName: window.document.location.hostname,
		// 			sign: 'shinemonitor',
		// 			salt: new Date().getTime(),
		// 		},
		// 		function (err, dat, desc) {
		// 			if (err.err == 0) {
		// 				$("#cusMainImg").attr('src', err.dat.logoMainStr);
		// 				// $("body").css("background", "url(" +  err.dat.backgroundStr + ") center center no-repeat")
		// 			} else {

		// 			}
		// 		});
		    var DomainNameStr = window.document.location.hostname;
		    var DomainNameIMG = new Image()
		    DomainNameIMG.src = document.location.protocol + "//img.shinemonitor.com/img/custom/cus/"+DomainNameStr.replace(/\./g, '')+"/main.png"
		    DomainNameIMG.onload =  function () {
		    	$("#cusMainImg").attr('src', document.location.protocol + "//img.shinemonitor.com/img/custom/cus/"+DomainNameStr.replace(/\./g, '')+"/main.png");
		    	// $("body").css("background", "url(" + document.location.protocol + '//img.shinemonitor.com/img/custom/cus/'+DomainNameStr.replace(/\./g, '')+'/background.png' + ") center center no-repeat")
		    }
		    // DomainNameIMG.onerror =  function () {
		    // 	$("#cusMainImg").attr('src', "/assets/images/cus/shinemonitor/main.png");
		    // 	// $("body").css("background", "url(" + "/assets/images/cus/shinemonitor/background.png" + ") center center no-repeat")
		    // }
		if(window.document.location.hostname == "htysolar.shinemonitor.com") {
			$(".hengtongyuan").show()
		}
		// 金源
		if (window.document.location.hostname == "jinyuanleasing.shinemonitor.com") {
			$(".cusIcp").hide()
			$(".cusIcp1").hide()
		}

		time = setInterval(function() {
			if($("#statistic01").length > 0) {
				loadDataNoPlant()
			} else if(($("#stats00").length > 0) && ($("#plantBasic").css("display") == "block")) {
				loadStatistics()
			}
		}, 60000)
		if(storage_i18n_get_id() == 0) {
			$("#msgBtn").show()
		}
		$("#mainCurLang").text(storage_i18n_get());
	 
		checkLogin();
		getMsgBoxCount()
		getmsgbody(0)
		$("#userInfo").text(getCurrentUsername());
		$("#userInfo").next("span").text(getCurrentRoleName());
		$("#msgBtn").click(function() {
			http_async_request_public("&action=webEditMsgBox", function(err, dat, desc) {
				if(err == 0) {
					getMsgBoxCount()
				}
			})
			$("#msgBox").modal()
		})
		$("#accountLogout").click(function() {
			if(accountLogoutid) {
				accountLogout()
				accountLogoutid = false
			} else {
				window.location.href = "index.html"; //以前是/index.html";
			}
		})
	});
	// // 获取服务器节点
	// http_async_request_public("&action=queryDomainList&source=1&_app_client_=web&_app_id_="+window.document.location.hostname+"&_app_version_=1.0.6.3&i18n=" + getInterLang(), function(err, dat) {
	// 	if(err == 0) {
	// 		for (var i = 0; i < dat.length; i++) {
	// 		    $('<option value = "' + dat[i].url + '" title="' + dat[i].name + '">' + dat[i].name + '</option>').appendTo($("#selectNode"))
	// 		}
	// 		if(JSON.parse(window.localStorage.getItem("selectNodeValue")) == null||JSON.parse(window.localStorage.getItem("selectNodeValue")) == ''||JSON.parse(window.localStorage.getItem("selectNodeValue")) == undefined){
	// 			if(dat.length==0){
	// 				$('<option value = "'+ HTTP_INTERFACE_ADDRESS_NEW +'">'+getMultiLangError("Default_node")+'</option>').appendTo($("#selectNode "))
	// 			}
	// 		}else{
	// 			$("#selectNode").val(JSON.parse(window.localStorage.getItem("selectNodeValue")))
	// 		}
	// 	} else {
	// 		$('<option value = "'+ HTTP_INTERFACE_ADDRESS_NEW +'">'+getMultiLangError("Default_node")+'</option>').appendTo($("#selectNode "))
	// 	}
	// }, function()
	// {
	// 	$('<option value = "' + HTTP_INTERFACE_ADDRESS_NEW + '">'+getMultiLangError("Default_node")+'</option>').appendTo($("#selectNode "))
	// })
	// //节点切换
	// $("#selectNode").bind("change", function() {
	// 	var status = $("#selectNode option:selected").val()
	// 	window.localStorage.setItem("selectNodeValue", JSON.stringify(status));
	// 	window.location.reload();
	// })

	//监测是否登陆了,成功-生成顶部下拉列表,失败-提示重新登陆
	function checkLogin() {
		if(!storage_check_login()) {
			window.location.href = "/errorNoLogin.html";
			return;
		}
		var currUsr = storage_get_current_usr();
		if(currUsr.dat.role === USR_ROLE_GROUP) //如果为集团账号的话,跳转至
		{
			$("#checkedPlant").text("电站总览");
			var item = "<li onclick='go2GroupMain()'><a role='menuitem' tabindex='-1' href='main.html#'>" + "电站总览" + "</a></li>";
			$("#plantlist ul").append(item);
			go2GroupMain();
			return;
		}
		getPlantList();
	}
	if(getInterLang() == "zh_CN"){
		flowExpirationDetection()
	}

	//流量到期预警
	function flowExpirationDetection(){
		http_async_request_public("&action=flowExpirationDetection", function(err, dat, desc) {
				if(err == 0) {
					if(dat.total>0){
						$('#flowExpirationDetection').modal('show')
						sessionStorage.setItem("trafficWarningLoad", dat.item[0].maxLoad);
						sessionStorage.setItem("trafficWarningType", dat.item[0].cType);
					}
				}
			})
	}

	//点击立即充值前往充值页面
	$("#nowRecharge").click(function() {
		IS_Flow_Expiration_Detection = true
		$('#flowExpirationDetection').modal('hide')
		setTimeout(() => {
			loadHtml("mainArea", "/sys/systemSettings.html");
		}, 500);
	})
	var IS_Flow_Expiration_Detection = false

	function go2GroupMain() {
		loadHtml("mainArea", "groupPlantList.html");
	}
	/*生成普通用户主页面顶部电站下拉列表,跳转页面*/
	function getPlantList() {
		$("#checkedPlant").text(getMultiLangError("plants_overview"));
		$("#mainArea").showLoading()

		http_async_request_public("&action=queryPlantsInfo", function(err, dat) /* 返回用户的电站列表. */ {
				$("#mainArea").hideLoading();
				if(err == WS_ERR_NONE) {
					var plantSum = "<li onclick='go2Main()'><a role='menuitem' tabindex='-1' href='main.html#'>" + getMultiLangError("plants_overview") + "</a></li>" + "<li onclick='main2AddPlant()'><a role='menuitem' tabindex='-1' href='main.html#'>" + getMultiLangError("add_plant") + "</a></li>";
					$("#plantlist ul").append(plantSum);
					var plant = dat.info;
					for(var i = 0; i < plant.length; i++) {
						var item = "<li onclick='getPlantId(this.id)' id=" + "plant_" + plant[i].pid + "><a role='menuitem' tabindex='-1' href='main.html#'' > " + plant[i].pname + "</a></li>";
						$("#plantlist ul").append(item);
					}
					var url = window.location.href;
					 
					if(url.indexOf("forwardplantid") > 0) /** 由某个上级用户跳转而来. */ {
						//						老的url截取
						//						var key = "forwardplantid";
						//						var plantId = "plant_" + url.substring((url.indexOf(key) + key.length + 1), url.length);
						//						 新的url截取			

						var plantId = "plant_" + GetRequest().forwardplantid;
						getPlantId(plantId);
						return;
					}
					if(plant.length == 1) /** 只有一个电站. */ {
						var id = "plant_" + plant[0].pid;
						getPlantId(id);
					} else {
						loadHtml("mainArea", "/solarmonitor.github.io/plant/plantlist.html");
					}
				} else {
					//没有电站,获取获取电站失败的时候,依然要加载主页面
					var plantSum = "<li onclick='go2Main()'><a role='menuitem' tabindex='-1' href='main.html#'>" + getMultiLangError("plants_overview") + "</a></li>" + "<li onclick='main2AddPlant()'><a role='menuitem' tabindex='-1' href='main.html#'>" + getMultiLangError("add_plant") + "</a></li>";
					$("#plantlist ul").append(plantSum);
					loadHtml("mainArea", "/solarmonitor.github.io/plant/plantlist.html");
				}
			},
			function() {
				$("#mainArea").hideLoading();
				console.log("主页面下拉列表生成失败"); /* 取不到电站. */
			});
	}

	// 点击系统设置
	function go2System() {
		loadHtml("mainArea", "/sys/systemSettings.html");
	}

	function go2System2() {
		loadHtml("mainArea", "/sys/systemSettings2.html");
	}
	// //电站总览加载中
	// function mainStatusLoading() {
	// 	for(var i = 0; i < 11; i++) {
	// 		$("<img src='assets/vendor/showLoading/images/482.gif' style='width:30px;'/>").appendTo($("#statistic" + (i < 10 ? "0" + i : i)))
	// 	}

	// }
	// //电站总览加载完成停止转圈
	// function mainStatusHideLoad() {
	// 	for(var i = 0; i < 11; i++) {
	// 		$("#statisticDD" + (i < 10 ? "0" + i : i)).children("img").remove();
	// 	}
	// }

	// 单独为电池添加加载圈圈
	function onlyForBattery(num) {
		if(num != -1) {
			$("#statisticDD08").showLoading();
		} else {
			$("#statisticDD08").hideLoading();
		}
		$("#statisticDD08").hideLoading();
	}
	//----------------------------------------------------------------------------------------------------
	//去获取电站总览数据
	function loadDataNoPlant() {
		//public
		var action = "&action=queryPlantsCurrentData&par=ENERGY_TODAY,ENERGY_MONTH,ENERGY_YEAR,ENERGY_TOTAL,ENERGY_PROCEEDS,ENERGY_COAL,ENERGY_CO2,ENERGY_SO2,BATTERY_SOC"
		//var action = "&action=plantStatistic&par=ENERGY_TODAY,ENERGY_MONTH,ENERGY_YEAR,ENERGY_TOTAL,ENERGY_PROCEEDS,ENERGY_COAL,ENERGY_CO2,ENERGY_SO2,BATTERY_SOC" 
		var currUsr = storage_get_current_usr().dat;
		var salt = new Date().getTime();
		var sign = hex_sha1(salt + currUsr.secret + currUsr.token + action);
		var url = HTTP_INTERFACE_ADDRESS_NEW + "?sign=" + sign + "&salt=" +
			salt + "&token=" + currUsr.token + action;
		var ajax = $.ajax({
			async: true,
			type: "get",
			url: url,
			dataType: "jsonp",
			jsonp: "callback",
			success: function(data, status) {
				var dat = eval(data);
				var err = dat.err;
				var json = dat.dat;
				if(err == WS_ERR_NONE) {
					//                      		mainStatusHideLoad()
					for(var i = 0; i < 9; i++) {

						if(i < 4) {
							$("#statistic" + (i < 10 ? "0" + i : i)).html(formatKwh(json[i].val));
						} else if(i == 4) {
							var num = json[i].val.replace(/[^\d^\.]+/ig,"");
							$("#statistic04").html(getErrorCodeDesc2(GET_ERR_DESC, "err"+333)+num.substring(0,num.indexOf(".")+2));
						} else if(i == 8) {
							if(json[i].val == -1) {
								$("#battery_soc").hide();
								ifShowElectric();
								onlyForBattery(json[i].val);
							} else {
								$("#battery_soc").show();
								onlyForBattery(json[i].val);
								$("#statistic08").html(formatPercentage(json[i].val));
							}
						} else {
							$("#statistic" + (i < 10 ? "0" + i : i)).html(formatKg(json[i].val));
						}
					}

				} else {
					mainStatusHideLoad()
					for(var i = 0; i < 9; i++) {
                      	$("#statistic" + (i < 10 ? "0" + i : i)).html('0.0');
                      }
					console.log("电站总览数据获取失败: " + err);
				}

			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				mainStatusHideLoad();
				console.log("电站概况单个电站查询失败")
			},
			complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
				　　　　
				if(status == 'timeout') { //超时,status还有success,error等值的情况
					　　　　　
					ajax.abort();　　　　　
					console.log("超时");　　　　
				}　　
			}
		})
	}

	//单个电站-总览  重写ajax是为了防止多层回调导致内存溢出 设置超时是为了防止页面长时间锁死
	function loadStatistics() {
		//		http_normal_oper("&action=plantCurrentData&id=" + MAIN_CHOOSE_PLANT_ID + "&par=ENERGY_TODAY,ENERGY_MONTH,ENERGY_YEAR,ENERGY_TOTAL,ENERGY_PROCEEDS,ENERGY_CO2,CURRENT_TEMP,CURRENT_RADIANT,BATTERY_SOC", function(err, json)
		//		{
		//var action = "&action=plantCurrentData&id=" + MAIN_CHOOSE_PLANT_ID + "&par=ENERGY_TODAY,ENERGY_MONTH,ENERGY_YEAR,ENERGY_TOTAL,ENERGY_PROCEEDS,ENERGY_CO2,CURRENT_TEMP,CURRENT_RADIANT,BATTERY_SOC,ENERGY_COAL,ENERGY_SO2"

		var action = "&action=queryPlantCurrentData&plantid=" + MAIN_CHOOSE_PLANT_ID + "&par=ENERGY_TODAY,ENERGY_MONTH,ENERGY_YEAR,ENERGY_TOTAL,ENERGY_PROCEEDS,ENERGY_CO2,CURRENT_TEMP,CURRENT_RADIANT,BATTERY_SOC,ENERGY_COAL,ENERGY_SO2"
		var currUsr = storage_get_current_usr().dat;
		var salt = new Date().getTime();
		var sign = hex_sha1(salt + currUsr.secret + currUsr.token + action);
		var url = HTTP_INTERFACE_ADDRESS_NEW + "?sign=" + sign + "&salt=" +
			salt + "&token=" + currUsr.token + action;
		var ajax = $.ajax({

			async: true,
			type: "get",
			url: url,
			cache: false,
			dataType: "jsonp",
			jsonp: "callback",
			timeout: 30000,
			success: function(data, status) {
				var dat = eval(data);
				var err = dat.err;
				var json = dat.dat;
				if(err == WS_ERR_NONE) {
					for(var i = 0; i < 11; ++i) {
						var num = json[i].val;
						if(i < 4) {
							$("#stats" + (i < 10 ? "0" + i : i)).text(formatKwh(num));
						} else if(i == 4) {
							$("#stats04").text(num.substring(0, num.length - 1));
						} else if(i == 6) {
							$("#stats05").text(formatKg(num));
						} else if(i == 10) {
							if(num == -1) {
								$("#battery_soc").hide();
								ifShowElectric();
								onlyForBattery(num);
							} else {
								$("#battery_soc").show();
								$("#stats10").text(formatPercentage(num));
								onlyForBattery(num);
							}

						} else if(i == 8) {

							if(num == "null") {
								plantNoEnv(i);
								if(json[9].val == "null") {
									$("#statsOk07").text(formatKg(json[7].val))
									$("#statsOk06").text(formatKg(json[5].val))
								}
							} else {
								if(json[9].val != "null") {
									$("#statsSec06,#statsSec07").hide()

								}
								plantHaveEnv(i);
								$("#stats08").text(num + "℃");
							}

						} else {
							if(num == "null") {
								plantNoEnv(i);
							} else {
								plantHaveEnv(i);
								$("#stats09").text(num + "kW/m2");
							}

						}
					}
				} else {
					plantStatusHideLoad();
					for(var i = 0; i < 11; ++i) {
						if(i >= 10) {
							$("#stats10").text("0.0");
						} else if(i ==6||i == 7){
							$("#statsOk" + (i < 10 ? "0" + i : i)).text("0.0");
						} 
						else {
							$("#stats" + (i < 10 ? "0" + i : i)).text("0.0");
						}
					}
					console.log("电站概况单个电站查询失败: " + err);
				}

				loadDeviceCount();
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				plantStatusHideLoad();
				console.log("电站概况单个电站查询失败")
			},
			complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
				　　　　
				if(status == 'timeout') { //超时,status还有success,error等值的情况
					　　　　　
					ajax.abort();　　　　　
					console.log("超时");　　
				}　
			}　
		});
	}

	/*电站概况没有环境监测仪数据*/
	function plantNoEnv(i) {
		$("#statsSec" + (i < 10 ? "0" + i : i)).removeClass("stats-bg-green").addClass("stats-bg-gray");
		$("#statsBad" + (i < 10 ? "0" + i : i)).removeClass("hidden");
		$("#statsOk" + (i < 10 ? "0" + i : i)).addClass("hidden").parents("#statsSec08,#statsSec09").hide();
	}

	/*电站概况如果有环境监测仪数据*/
	function plantHaveEnv(i) {
		if($("#statsSec" + (i < 10 ? "0" + i : i)).hasClass("stats-bg-gray")) {
			$("#statsSec" + (i < 10 ? "0" + i : i)).removeClass("stats-bg-gray").addClass("stats-bg-green");
			$("#statsBad" + (i < 10 ? "0" + i : i)).addClass("hidden");
			$("#statsOk" + (i < 10 ? "0" + i : i)).removeClass("hidden");
		}
	}
	//消息盒子
	//	function getMsgBoxCount() {
	//		http_async_request_public("&action=webQueryMsgBoxCount&readed=false", function(err, dat, desc) {
	//			if(err == 0) {
	//				$("#msgBtn").attr("title", "今日未读告警消息" + dat.msgCount == undefined ? "0" : dat.msgCount + "条")
	//				if(dat.msgCount == 0)
	//					$("#MsgBoxCount").css("background-color", "#5bcc52").text(dat.msgCount == undefined ? "0" : dat.msgCount)
	//				else
	//					$("#MsgBoxCount").css("background-color", "red").text(dat.msgCount == undefined ? "0" : dat.msgCount)
	//			} else if(err == 12) {
	//				$("#MsgBoxCount").css("background-color", "#5bcc52").text("0")
	//			}
	//		})
	//	}
	//直接查未处理告警数
	function getMsgBoxCount() {
		http_async_request_public("&action=webQueryPlantsWarning&handle=false", function(err, dat, desc) {
			if(err == 0) {
				$("#msgBtn").attr("title", "今日未读告警消息" + dat.total == undefined ? "0" : dat.total + "条")
				if(dat.total == 0)
					$("#MsgBoxCount").css("background-color", "#5bcc52").text(dat.total == undefined ? "0" : dat.total)
				else
					$("#MsgBoxCount").css("background-color", "red").text(dat.total == undefined ? "0" : dat.total)
			} else if(err == 12) {
				$("#MsgBoxCount").css("background-color", "#5bcc52").text("0")
			}
		})
	}

	function getmsgbody(page, cur) {
		http_async_request_public(encodeURI("&action=webQueryPlantsWarning&sdate=" +
			parseDate2yyyymmdd(new Date()) + " 00:00:00&edate=" + parseDate2yyyymmdd(new Date()) +
			" 23:59:59&i18n=" + getInterLang() + "&handle=false&page=" + page + "&pagesize=8"), function(err, dat, desc) {
			$("#msgbody").empty()
			if(err == 0) {
				var totalPage = (dat.total % 8 == 0 ? dat.total / 8 : Math.ceil(dat.total / 8));
				$('#pageMsg').paging2({
					pageNo: page + 1,
					totalPage: totalPage,
					callback: function(cur) {
						getmsgbody(cur - 1, cur)
					}
				})
				for(var i = 0; i < dat.warning.length; ++i) {
					if(dat.warning[i].level == 0)
						level = '告警';
					if(dat.warning[i].level == 1)
						level = '错误';
					if(dat.warning[i].level == 2)
						level = '故障';
					$("<tr index='" + i + "'><td>" + dat.warning[i].gts + "</td>" //
						+
						"<td>" + dat.warning[i].plant + "</td>" //
						+
						"<td>" + level + "</td>" //
						+
						"<td>" + fieldAutoDisp(dat.warning[i].code) + "</td>" //
						+
						"<td>" + dat.warning[i].sn + "</td>" //
						+
						"<td>" + dat.warning[i].pn + "</td>" //
						+
						"<td>" + dat.warning[i].desc + "</td>" //
						+
						"<td>" + (dat.warning[i].handle ? "已处理" : "未处理") + "</td>" //
						+
						"<td>" + fieldAutoDisp(dat.warning[i].cts) + "</td></tr>" // 
					).appendTo($("#msgbody"))
				}
			} else {
				$("<tr><td colspan='9'>无消息</td></tr>").appendTo($("#msgbody"))
			}
		})
	}
</script>